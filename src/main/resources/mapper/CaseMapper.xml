<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ngtesting.platform.dao.CaseDao" >

    <insert id="create" parameterType="TstCase" useGeneratedKeys="true" keyProperty="id">
        insert into TstCase (name,type,priority,contentType,estimate,pId,projectId,createById,isLeaf,ordr,
        deleted,disabled,createTime,version)

        values (#{name},#{type},#{priority},#{contentType},#{estimate},#{pId},#{projectId},#{createById},#{isLeaf},#{ordr},
        #{deleted},#{disabled},#{createTime},#{version})
    </insert>

    <select id="query" resultType="TstCase">
        SELECT * FROM TstCase o

        WHERE o.projectId = #{projectId}
         AND O.deleted != TRUE  AND o.disabled != TRUE

        ORDER BY pId, ordr
    </select>

    <select id="get" resultType="TstCase">
        SELECT * FROM TstCase o

        WHERE o.id = #{id}
    </select>

    <select id="getDetail" resultMap="caseMaps">
        SELECT * FROM TstCase o

        WHERE o.id = #{id}
    </select>

    <resultMap id="caseMaps" type="TstCase" autoMapping="true">
        <id column="id" property="id"/>

        <collection property="steps" select="com.ngtesting.platform.dao.CaseStepDao.listByCaseId"
                    column="{id=id}">
        </collection>

        <collection property="histories" select="com.ngtesting.platform.dao.CaseHistoryDao.listByCaseId"
                    column="{id=id}">
        </collection>

        <collection property="comments" select="com.ngtesting.platform.dao.CaseCommentsDao.listByCaseId"
                    column="{id=id}">
        </collection>
    </resultMap>

</mapper>
